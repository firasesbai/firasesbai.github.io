// Copyright (c) 2017-2024 Zalando SE
// The above copyright notice and this permission notice shall be included in
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
function radar_visualization(t){function e(){var t=1e4*Math.sin(b++);return t-Math.floor(t)}function n(t,n){return t+e()*(n-t)}function r(t,n){return t+.5*(e()+e())*(n-t)}function a(t){var e=t.x,n=t.y;return{t:Math.atan2(n,e),r:Math.sqrt(e*e+n*n)}}function l(t){return{x:t.r*Math.cos(t.t),y:t.r*Math.sin(t.t)}}function o(t,e,n){var r=Math.min(e,n),a=Math.max(e,n);return Math.min(Math.max(t,r),a)}function i(t,e,n){return{t:t.t,r:o(t.r,e,n)}}function s(t,e,n){return{x:o(t.x,e.x,n.x),y:o(t.y,e.y,n.y)}}function d(t,e){var o={t:v[t].radial_min*Math.PI,r:0===e?30:w[e-1].radius},d={t:v[t].radial_max*Math.PI,r:w[e].radius},f={x:15*v[t].factor_x,y:15*v[t].factor_y},c={x:w[3].radius*v[t].factor_x,y:w[3].radius*v[t].factor_y};return{clipx:function(t){var e=i(a(s(t,f,c)),o.r+15,d.r-15);return t.x=l(e).x,t.x},clipy:function(t){var e=i(a(s(t,f,c)),o.r+15,d.r-15);return t.y=l(e).y,t.y},random:function(){return l({t:n(o.t,d.t),r:r(o.r,d.r)})}}}function f(t,e){return"translate("+t+","+e+")"}function c(t){return[Math.max(0,400*v[t].factor_x)-420,Math.max(0,400*v[t].factor_y)-420,440,440].join(" ")}function p(e,n,r,a=null,l=null){const o=n<2?0:r;let i=null==a?-16:a*t.legend_line_height;return n%2==1&&(i=i+36+l),f(t.legend_offset[e].x+o,t.legend_offset[e].y+i)}function y(e){let n=0;e.each(function(){const e=d3.select(this),r=e.text().split(" ");let a=[];const l=`${e.text().split(".")[0]}. |`,o=e.append("tspan").text(l),i=e.append("tspan").text("|"),s=o.node().getComputedTextLength()-i.node().getComputedTextLength();e.text(null);let d=e.append("tspan").attr("x",0).attr("y",n).attr("dy",0);for(let n=0;n<r.length;n++)a.push(r[n]),d.text(a.join(" ")),d.node().getComputedTextLength()>t.legend_column_width&&1!==n&&(a.pop(),d.text(a.join(" ")),a=[r[n]],d=e.append("tspan").attr("x",s).attr("dy",t.legend_line_height).text(r[n]));const f=e.node().getBBox();n=f.y+f.height})}function u(e){if(e.active||t.print_layout){var n=d3.select("#bubble text").text(e.label).node().getBBox();d3.select("#bubble").attr("transform",f(e.x-n.width/2,e.y-16)).style("opacity",.8),d3.select("#bubble rect").attr("x",-5).attr("y",-n.height).attr("width",n.width+10).attr("height",n.height+4),d3.select("#bubble path").attr("transform",f(n.width/2-5,3))}}function _(){d3.select("#bubble").attr("transform",f(0,0)).style("opacity",0)}function x(t){var e=document.getElementById("legendItem"+t.id);e.setAttribute("filter","url(#solid)"),e.setAttribute("fill","white")}function g(t){var e=document.getElementById("legendItem"+t.id);e.removeAttribute("filter"),e.removeAttribute("fill")}function h(){O.attr("transform",function(t){return f(t.segment.clipx(t),t.segment.clipy(t))})}function m(){var e=d3.select("body").append("table").attr("class","radar-table").style("border-collapse","collapse").style("position","relative").style("top","-70px").style("margin-left","50px").style("margin-right","50px").style("font-family",t.font_family).style("font-size","13px").style("text-align","left"),n=e.append("thead"),r=e.append("tbody"),a=`${100/t.rings.length}%`;n.append("tr").style("border","1px solid #ddd").selectAll("th").data(t.rings).enter().append("th").style("padding","8px").style("border","1px solid #ddd").style("background-color",t=>t.color).style("color","#fff").style("width",a).text(t=>t.name),r.append("tr").style("border","1px solid #ddd").selectAll("td").data(t.rings).enter().append("td").style("padding","8px").style("border","1px solid #ddd").style("width",a).text(t=>t.description)}t.svg_id=t.svg||"radar",t.width=t.width||1450,t.height=t.height||1e3,t.colors="colors"in t?t.colors:{background:"#fff",grid:"#dddde0",inactive:"#ddd"},t.print_layout=!("print_layout"in t)||t.print_layout,t.links_in_new_tabs=!("links_in_new_tabs"in t)||t.links_in_new_tabs,t.repo_url=t.repo_url||"#",t.print_ring_descriptions_table="print_ring_descriptions_table"in t&&t.print_ring_descriptions_table,t.legend_offset=t.legend_offset||[{x:450,y:90},{x:-675,y:90},{x:-675,y:-310},{x:450,y:-310}],t.title_offset=t.title_offset||{x:-675,y:-420},t.footer_offset=t.footer_offset||{x:-155,y:450},t.legend_column_width=t.legend_column_width||140,t.legend_line_height=t.legend_line_height||10;var b=42;const v=[{radial_min:0,radial_max:.5,factor_x:1,factor_y:1},{radial_min:.5,radial_max:1,factor_x:-1,factor_y:1},{radial_min:-1,radial_max:-.5,factor_x:-1,factor_y:-1},{radial_min:-.5,radial_max:0,factor_x:1,factor_y:-1}],w=[{radius:130},{radius:220},{radius:310},{radius:400}];for(var k=0;k<t.entries.length;k++){(q=t.entries[k]).segment=d(q.quadrant,q.ring);var z=q.segment.random();q.x=z.x,q.y=z.y,q.color=q.active||t.print_layout?t.rings[q.ring].color:t.colors.inactive}var M=new Array(4);for(let t=0;t<4;t++){M[t]=new Array(4);for(var A=0;A<4;A++)M[t][A]=[]}for(k=0;k<t.entries.length;k++){var q;M[(q=t.entries[k]).quadrant][q.ring].push(q)}var B=1;for(quadrant of[2,3,1,0])for(A=0;A<4;A++){var I=M[quadrant][A];I.sort(function(t,e){return t.label.localeCompare(e.label)});for(k=0;k<I.length;k++)I[k].id=""+B++}t.scale=t.scale||1;var C=t.width*t.scale,j=t.height*t.scale,L=d3.select("svg#"+t.svg_id).style("background-color",t.colors.background).attr("width",C).attr("height",j),P=L.append("g");"zoomed_quadrant"in t?L.attr("viewBox",c(t.zoomed_quadrant)):P.attr("transform",f(C/2,j/2).concat(`scale(${t.scale})`));var S=P.append("g");t.font_family=t.font_family||"Arial, Helvetica",S.append("line").attr("x1",0).attr("y1",-400).attr("x2",0).attr("y2",400).style("stroke",t.colors.grid).style("stroke-width",1),S.append("line").attr("x1",-400).attr("y1",0).attr("x2",400).attr("y2",0).style("stroke",t.colors.grid).style("stroke-width",1);var T=S.append("defs").append("filter").attr("x",0).attr("y",0).attr("width",1).attr("height",1).attr("id","solid");T.append("feFlood").attr("flood-color","rgb(0, 0, 0, 0.8)"),T.append("feComposite").attr("in","SourceGraphic");for(k=0;k<w.length;k++)S.append("circle").attr("cx",0).attr("cy",0).attr("r",w[k].radius).style("fill","none").style("stroke",t.colors.grid).style("stroke-width",1),t.print_layout&&S.append("text").text(t.rings[k].name).attr("y",62-w[k].radius).attr("text-anchor","middle").style("fill",t.rings[k].color).style("opacity",.35).style("font-family",t.font_family).style("font-size","42px").style("font-weight","bold").style("pointer-events","none").style("user-select","none");if(t.print_layout){P.append("a").attr("href",t.repo_url).attr("transform",f(t.title_offset.x,t.title_offset.y)).append("text").attr("class","hover-underline").text(t.title).style("font-family",t.font_family).style("font-size","30").style("font-weight","bold"),P.append("text").attr("transform",f(t.title_offset.x,t.title_offset.y+20)).text(t.date||"").style("font-family",t.font_family).style("font-size","14").style("fill","#999"),P.append("text").attr("transform",f(t.footer_offset.x,t.footer_offset.y)).text("\u25b2 moved up     \u25bc moved down     \u2605 new     \u2b24 no change").attr("xml:space","preserve").style("font-family",t.font_family).style("font-size","12px");const e=P.append("g");for(let n=0;n<4;n++){e.append("text").attr("transform",f(t.legend_offset[n].x,t.legend_offset[n].y-45)).text(t.quadrants[n].name).style("font-family",t.font_family).style("font-size","18px").style("font-weight","bold");let r=0;for(let a=0;a<4;a++)a%2==0&&(r=0),e.append("text").attr("transform",p(n,a,t.legend_column_width,null,r)).text(t.rings[a].name).style("font-family",t.font_family).style("font-size","12px").style("font-weight","bold").style("fill",t.rings[a].color),e.selectAll(".legend"+n+a).data(M[n][a]).enter().append("a").attr("href",function(t){return t.link?t.link:"#"}).attr("target",function(e){return e.link&&t.links_in_new_tabs?"_blank":null}).append("text").attr("transform",function(e,l){return p(n,a,t.legend_column_width,l,r)}).attr("class","legend"+n+a).attr("id",function(t){return"legendItem"+t.id}).text(function(t){return t.id+". "+t.label}).style("font-family",t.font_family).style("font-size","11px").on("mouseover",function(t,e){u(e),x(e)}).on("mouseout",function(t,e){_(e),g(e)}).call(y).each(function(){r+=d3.select(this).node().getBBox().height})}}var $=P.append("g").attr("id","rink"),E=P.append("g").attr("id","bubble").attr("x",0).attr("y",0).style("opacity",0).style("pointer-events","none").style("user-select","none");E.append("rect").attr("rx",4).attr("ry",4).style("fill","#333"),E.append("text").style("font-family",t.font_family).style("font-size","10px").style("fill","#fff"),E.append("path").attr("d","M 0,0 10,0 5,8 z").style("fill","#333");var O=$.selectAll(".blip").data(t.entries).enter().append("g").attr("class","blip").attr("transform",function(e,n){return p(e.quadrant,e.ring,t.legend_column_width,n)}).on("mouseover",function(t,e){u(e),x(e)}).on("mouseout",function(t,e){_(e),g(e)});O.each(function(e){var n=d3.select(this);if(e.active&&Object.prototype.hasOwnProperty.call(e,"link")&&e.link&&(n=n.append("a").attr("xlink:href",e.link),t.links_in_new_tabs&&n.attr("target","_blank")),1==e.moved?n.append("path").attr("d","M -11,5 11,5 0,-13 z").style("fill",e.color):-1==e.moved?n.append("path").attr("d","M -11,-5 11,-5 0,13 z").style("fill",e.color):2==e.moved?n.append("path").attr("d",d3.symbol().type(d3.symbolStar).size(200)).style("fill",e.color):n.append("circle").attr("r",9).attr("fill",e.color),e.active||t.print_layout){var r=t.print_layout?e.id:e.label.match(/[a-z]/i);n.append("text").text(r).attr("y",3).attr("text-anchor","middle").style("fill","#fff").style("font-family",t.font_family).style("font-size",function(){return r.length>2?"8px":"9px"}).style("pointer-events","none").style("user-select","none")}}),d3.forceSimulation().nodes(t.entries).velocityDecay(.19).force("collision",d3.forceCollide().radius(12).strength(.85)).on("tick",h),t.print_ring_descriptions_table&&m()}