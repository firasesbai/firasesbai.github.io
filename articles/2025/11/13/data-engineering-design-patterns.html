<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>Data Engineering Design Patterns | Firas Esbai</title> <meta name="generator" content="Jekyll v4.3.4"> <meta property="og:title" content="Data Engineering Design Patterns"> <meta name="author" content="Firas Esbai"> <meta property="og:locale" content="en_US"> <meta name="description" content="Explore essential data engineering design patterns including WAP, CDC, DLQ and cumulative aggregate tables."> <meta property="og:description" content="Explore essential data engineering design patterns including WAP, CDC, DLQ and cumulative aggregate tables."> <link rel="canonical" href="https://www.firasesbai.com/articles/2025/11/13/data-engineering-design-patterns.html"> <meta property="og:url" content="https://www.firasesbai.com/articles/2025/11/13/data-engineering-design-patterns.html"> <meta property="og:site_name" content="Firas Esbai"> <meta property="og:image" content="https://www.firasesbai.com/assets/images/articles/28_wap_iceberg_audit_branch.png"> <meta property="og:type" content="article"> <meta property="article:published_time" content="2025-11-13T00:00:00+00:00"> <meta name="twitter:card" content="summary_large_image"> <meta property="twitter:image" content="https://www.firasesbai.com/assets/images/articles/28_wap_iceberg_audit_branch.png"> <meta property="twitter:title" content="Data Engineering Design Patterns"> <script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Firas Esbai"},"dateModified":"2025-12-07T15:04:21+00:00","datePublished":"2025-11-13T00:00:00+00:00","description":"Explore essential data engineering design patterns including WAP, CDC, DLQ and cumulative aggregate tables.","headline":"Data Engineering Design Patterns","image":"https://www.firasesbai.com/assets/images/articles/28_wap_iceberg_audit_branch.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.firasesbai.com/articles/2025/11/13/data-engineering-design-patterns.html"},"url":"https://www.firasesbai.com/articles/2025/11/13/data-engineering-design-patterns.html"}</script> <link rel="stylesheet" href="/assets/main.css"> <link type="application/atom+xml" rel="alternate" href="https://www.firasesbai.com/feed.xml" title="Firas Esbai"> <script async src="https://www.googletagmanager.com/gtag/js?id='G-3ET85T3WD3'"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-3ET85T3WD3");</script> </head> <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css"> <script>!function(e,t,n,s,c,a,i){e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},(a=t.createElement(n)).async=1,a.src=s,(i=t.getElementsByTagName(n)[0]).parentNode.insertBefore(a,i)}(window,document,"script","https://assets.mailerlite.com/js/universal.js","ml"),ml("account","1240462");</script> <link rel="stylesheet" href="/assets/css/bundles/global.css"> <link rel="stylesheet" href="/assets/css/bundles/post.css"> <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png?v=1"> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png?v=1"> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png?v=1"> <link rel="manifest" href="/assets/favicon/site.webmanifest"> <link rel="mask-icon" href="/assets/favicon/safari-pinned-tab.svg?v=1" color="#5bbad5"> <link rel="shortcut icon" href="/assets/favicon/favicon.ico?v=1"> <meta name="msapplication-TileColor" content="#da532c"> <meta name="theme-color" content="#ffffff"> <script type="text/javascript" src="/js/service-worker/service-worker.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id='G-3ET85T3WD3'"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-3ET85T3WD3");</script> <body> <header class="site-header" role="banner"> <div class="wrapper"> <a class="site-title" href="/" style="font-size: 26px"> Firas Esbai </a><nav class="site-nav"> <input type="checkbox" id="nav-trigger" class="nav-trigger"> <label for="nav-trigger"> <span class="menu-icon"> <svg viewbox="0 0 18 15" width="18px" height="15px"> <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path> </svg> </span> </label> <div class="trigger"> <a class="page-link" href="/blog/index.html" style="font-size: 20px">Blog</a> <a class="page-link" href="/contact/" style="font-size: 20px">Contact</a> </div> </nav> </div> </header><main class="page-content" aria-label="Content"> <div class="wrapper"> <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting"> <nav aria-label="breadcrumb"> <p class="breadcrumb"> <a href="/blog">Blog</a> &gt; <a href="/categories/data-engineering">Data Engineering</a> &gt; <span>Data Engineering Design Patterns</span> </p> </nav> <header class="post-header"> <h1 class="post-title p-name" itemprop="name headline">Data Engineering Design Patterns</h1> <div class="post-tags"> <a href="/archive/#data-engineering" class="post-tag-badge">Data Engineering</a> <a href="/archive/#data-architecture" class="post-tag-badge">Data Architecture</a> </div> <p class="post-meta"><time class="dt-published" datetime="2025-11-13T00:00:00+00:00" itemprop="datePublished"> November 13, 2025 - </time> <span class="reading-time" title="Estimated read time"> 7 min read </span> <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span class="p-author h-card" itemprop="name"> - Firas Esbai</span></span></p> <p class="post-meta last-updated"> Last updated: <time datetime="2025-12-07T15:04:21+00:00" itemprop="dateModified"> December 07, 2025 </time> </p> </header> <div class="post-content e-content" itemprop="articleBody"> <p><em>In this article, we will look at common data engineering design patterns.</em></p> <p>Design patterns are standard solutions to common problems. They represent best practices and templates that can be reused in multiple situations. In this article, we will explore four common patterns that can be leveraged to ensure reliability, performance and observability in data pipelines.</p> <p><em>So let’s get started!</em></p> <hr> <h1> Contents </h1> <ul id="markdown-toc"> <li><a href="#write-audit-publish-wap" id="markdown-toc-write-audit-publish-wap">Write-Audit-Publish (WAP)</a></li> <li> <a href="#change-data-capture-cdc" id="markdown-toc-change-data-capture-cdc">Change Data Capture (CDC)</a> <ul> <li><a href="#log-based-cdc" id="markdown-toc-log-based-cdc">Log-based CDC</a></li> <li><a href="#trigger-based-cdc" id="markdown-toc-trigger-based-cdc">Trigger-based CDC</a></li> <li><a href="#timestamp-based-cdc" id="markdown-toc-timestamp-based-cdc">Timestamp-based CDC</a></li> </ul> </li> <li><a href="#dead-letter-queue-dlq" id="markdown-toc-dead-letter-queue-dlq">Dead-Letter Queue (DLQ)</a></li> <li><a href="#cumulative-aggregate-table" id="markdown-toc-cumulative-aggregate-table">Cumulative Aggregate Table</a></li> <li><a href="#recap" id="markdown-toc-recap">Recap</a></li> <li><a href="#resources" id="markdown-toc-resources">Resources</a></li> </ul> <hr> <h2 id="write-audit-publish-wap">Write-Audit-Publish (WAP)</h2> <p>Weather it is a schema evolution in the upstream data or third party APIs or incorrect join clause in your pipeline, preventing the resulting bad data and ensuring data integrity when writing to production systems requires rigorous validation.</p> <p>The WAP (Write-Audit-Publish) pattern is a critical data strategy that prevents such data quality issues. This method involves writing data to a staging table, auditing it for quality, and only publishing it to production if it passes checks. This ensures that the end users or consumers of this data can trust it.</p> <div class="jekyll-diagrams diagrams mermaid"> <svg id="my-svg" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="flowchart" style="max-width: 518.008px; background-color: white;" viewbox="0 0 518.0078125 582" role="graphics-document document" aria-roledescription="flowchart-v2"><style>#my-svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333}@keyframes edge-animation-frame{from{stroke-dashoffset:0}}@keyframes dash{to{stroke-dashoffset:0}}#my-svg .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round}#my-svg .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round}#my-svg .error-icon{fill:#522}#my-svg .error-text{fill:#522;stroke:#522}#my-svg .edge-thickness-normal{stroke-width:1px}#my-svg .edge-thickness-thick{stroke-width:3.5px}#my-svg .edge-pattern-solid{stroke-dasharray:0}#my-svg .edge-thickness-invisible{stroke-width:0;fill:none}#my-svg .edge-pattern-dashed{stroke-dasharray:3}#my-svg .edge-pattern-dotted{stroke-dasharray:2}#my-svg .marker{fill:#333;stroke:#333}#my-svg .marker.cross{stroke:#333}#my-svg svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px}#my-svg p{margin:0}#my-svg .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333}#my-svg .cluster-label text{fill:#333}#my-svg .cluster-label span{color:#333}#my-svg .cluster-label span p{background-color:transparent}#my-svg .label text,#my-svg span{fill:#333;color:#333}#my-svg .node rect,#my-svg .node circle,#my-svg .node ellipse,#my-svg .node polygon,#my-svg .node path{fill:#ececff;stroke:#9370db;stroke-width:1px}#my-svg .rough-node .label text,#my-svg .node .label text,#my-svg .image-shape .label,#my-svg .icon-shape .label{text-anchor:middle}#my-svg .node .katex path{fill:#000;stroke:#000;stroke-width:1px}#my-svg .rough-node .label,#my-svg .node .label,#my-svg .image-shape .label,#my-svg .icon-shape .label{text-align:center}#my-svg .node.clickable{cursor:pointer}#my-svg .root .anchor path{fill:#333!important;stroke-width:0;stroke:#333}#my-svg .arrowheadPath{fill:#333}#my-svg .edgePath .path{stroke:#333;stroke-width:2px}#my-svg .flowchart-link{stroke:#333;fill:none}#my-svg .edgeLabel{background-color:rgba(232,232,232,0.8);text-align:center}#my-svg .edgeLabel p{background-color:rgba(232,232,232,0.8)}#my-svg .edgeLabel rect{opacity:.5;background-color:rgba(232,232,232,0.8);fill:rgba(232,232,232,0.8)}#my-svg .labelBkg{background-color:rgba(232,232,232,0.5)}#my-svg .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#my-svg .cluster text{fill:#333}#my-svg .cluster span{color:#333}#my-svg div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80,100%,96.2745098039%);border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#my-svg .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333}#my-svg rect.text{fill:none;stroke-width:0}#my-svg .icon-shape,#my-svg .image-shape{background-color:rgba(232,232,232,0.8);text-align:center}#my-svg .icon-shape p,#my-svg .image-shape p{background-color:rgba(232,232,232,0.8);padding:2px}#my-svg .icon-shape rect,#my-svg .image-shape rect{opacity:.5;background-color:rgba(232,232,232,0.8);fill:rgba(232,232,232,0.8)}#my-svg .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em}#my-svg .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert}#my-svg :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif}</style> <g><marker id="my-svg_flowchart-v2-pointEnd" class="marker flowchart-v2" viewbox="0 0 10 10" refx="5" refy="5" markerunits="userSpaceOnUse" markerwidth="8" markerheight="8" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="my-svg_flowchart-v2-pointStart" class="marker flowchart-v2" viewbox="0 0 10 10" refx="4.5" refy="5" markerunits="userSpaceOnUse" markerwidth="8" markerheight="8" orient="auto"><path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="my-svg_flowchart-v2-circleEnd" class="marker flowchart-v2" viewbox="0 0 10 10" refx="11" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="my-svg_flowchart-v2-circleStart" class="marker flowchart-v2" viewbox="0 0 10 10" refx="-1" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="my-svg_flowchart-v2-crossEnd" class="marker cross flowchart-v2" viewbox="0 0 11 11" refx="12" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><marker id="my-svg_flowchart-v2-crossStart" class="marker cross flowchart-v2" viewbox="0 0 11 11" refx="-1" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"><path d="M259.004,62L259.004,66.167C259.004,70.333,259.004,78.667,259.004,86.333C259.004,94,259.004,101,259.004,104.5L259.004,108" id="L_A_B_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_A_B_0" data-points="W3sieCI6MjU5LjAwMzkwNjI1LCJ5Ijo2Mn0seyJ4IjoyNTkuMDAzOTA2MjUsInkiOjg3fSx7IngiOjI1OS4wMDM5MDYyNSwieSI6MTEyfV0=" marker-end="url(#my-svg_flowchart-v2-pointEnd)"></path><path d="M259.004,166L259.004,170.167C259.004,174.333,259.004,182.667,259.004,190.333C259.004,198,259.004,205,259.004,208.5L259.004,212" id="L_B_C_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_B_C_0" data-points="W3sieCI6MjU5LjAwMzkwNjI1LCJ5IjoxNjZ9LHsieCI6MjU5LjAwMzkwNjI1LCJ5IjoxOTF9LHsieCI6MjU5LjAwMzkwNjI1LCJ5IjoyMTZ9XQ==" marker-end="url(#my-svg_flowchart-v2-pointEnd)"></path><path d="M196.91,294L187.091,300.167C177.273,306.333,157.637,318.667,147.818,330.333C138,342,138,353,138,358.5L138,364" id="L_C_D_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_C_D_0" data-points="W3sieCI6MTk2LjkwOTc5NjQ2MzgxNTc4LCJ5IjoyOTR9LHsieCI6MTM4LCJ5IjozMzF9LHsieCI6MTM4LCJ5IjozNjh9XQ==" marker-end="url(#my-svg_flowchart-v2-pointEnd)"></path><path d="M321.098,294L330.916,300.167C340.735,306.333,360.371,318.667,370.19,332.333C380.008,346,380.008,361,380.008,368.5L380.008,376" id="L_C_F_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_C_F_0" data-points="W3sieCI6MzIxLjA5ODAxNjAzNjE4NDIsInkiOjI5NH0seyJ4IjozODAuMDA3ODEyNSwieSI6MzMxfSx7IngiOjM4MC4wMDc4MTI1LCJ5IjozODB9XQ==" marker-end="url(#my-svg_flowchart-v2-pointEnd)"></path><path d="M380.008,434L380.008,440.167C380.008,446.333,380.008,458.667,380.008,468.333C380.008,478,380.008,485,380.008,488.5L380.008,492" id="L_F_G_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_F_G_0" data-points="W3sieCI6MzgwLjAwNzgxMjUsInkiOjQzNH0seyJ4IjozODAuMDA3ODEyNSwieSI6NDcxfSx7IngiOjM4MC4wMDc4MTI1LCJ5Ijo0OTZ9XQ==" marker-end="url(#my-svg_flowchart-v2-pointEnd)"></path></g><g class="edgeLabels"><g class="edgeLabel"><g class="label" data-id="L_A_B_0" transform="translate(0, 0)"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignobject></g></g><g class="edgeLabel"><g class="label" data-id="L_B_C_0" transform="translate(0, 0)"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(138, 331)"><g class="label" data-id="L_C_D_0" transform="translate(-17.7890625, -12)"><foreignobject width="35.578125" height="24"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"><p>Pass</p></span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(380.0078125, 331)"><g class="label" data-id="L_C_F_0" transform="translate(-12.890625, -12)"><foreignobject width="25.78125" height="24"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"><p>Fail</p></span></div></foreignobject></g></g><g class="edgeLabel"><g class="label" data-id="L_F_G_0" transform="translate(0, 0)"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignobject></g></g></g><g class="nodes"><g class="node default" id="flowchart-A-0" transform="translate(259.00390625, 35)"><rect class="basic label-container" style="fill:#e0f7fa !important;stroke:#00bcd4 !important" x="-91.796875" y="-27" width="183.59375" height="54"></rect><g class="label" style="" transform="translate(-61.796875, -12)"><rect></rect><foreignobject width="123.59375" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>New Data Arrives</p></span></div></foreignobject></g></g><g class="node default" id="flowchart-B-1" transform="translate(259.00390625, 139)"><rect class="basic label-container" style="" x="-107.9765625" y="-27" width="215.953125" height="54"></rect><g class="label" style="" transform="translate(-77.9765625, -12)"><rect></rect><foreignobject width="155.953125" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Write to Staging Table</p></span></div></foreignobject></g></g><g class="node default" id="flowchart-C-3" transform="translate(259.00390625, 255)"><rect class="basic label-container" style="" x="-130" y="-39" width="260" height="78"></rect><g class="label" style="" transform="translate(-100, -24)"><rect></rect><foreignobject width="200" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;"><span class="nodeLabel"><p>Perform Data Quality Checks</p></span></div></foreignobject></g></g><g class="node default" id="flowchart-D-5" transform="translate(138, 407)"><rect class="basic label-container" style="fill:#c8e6c9 !important;stroke:#4caf50 !important" x="-130" y="-39" width="260" height="78"></rect><g class="label" style="" transform="translate(-100, -24)"><rect></rect><foreignobject width="200" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;"><span class="nodeLabel"><p>Write Data to Production Table</p></span></div></foreignobject></g></g><g class="node default" id="flowchart-F-7" transform="translate(380.0078125, 407)"><rect class="basic label-container" style="fill:#ffe0b2 !important;stroke:#ff9800 !important" x="-62.0078125" y="-27" width="124.015625" height="54"></rect><g class="label" style="" transform="translate(-32.0078125, -12)"><rect></rect><foreignobject width="64.015625" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Fire Alert</p></span></div></foreignobject></g></g><g class="node default" id="flowchart-G-9" transform="translate(380.0078125, 535)"><rect class="basic label-container" style="" x="-130" y="-39" width="260" height="78"></rect><g class="label" style="" transform="translate(-100, -24)"><rect></rect><foreignobject width="200" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;"><span class="nodeLabel"><p>Manually Troubleshoot DQ Issue</p></span></div></foreignobject></g></g></g></g></g></svg> </div> <p style="text-align:center;">Figure 1: Write Audit Publish Workflow</p> <p>In order to understand how the WAP pattern can be implemented we will use a key feature of the open table format Apache Iceberg: <a href="https://iceberg.apache.org/docs/1.6.1/branching/">Branches</a>.<br> For more information on Apache Iceberg and how it compares to the other well known formats, you can check <a href="https://www.firasesbai.com/articles/2024/11/17/evolution-analytical-data-architectures.html">this article</a>.</p> <p>The metadata of an Iceberg table stores a history of snapshots. These snapshots are changes applied to the table and are the basis for reader isolation and time travel. Iceberg branches are another named reference to a snapshot of a table. They can be used for handling GDPR requirements and retaining important historical snapshots for auditing or be part of an ETL pipeline enabling validation of new incoming data.</p> <p>Implementing the 3 steps WAP pattern using Iceberg branches would result in the following:</p> <ol> <li> <strong>Write</strong>: switch branch from <strong><em>main</em></strong> to an <strong><em>audit</em></strong> branch and commits updates there. Data is not yet accessible to downstream users who can only access main branch.</li> <li> <strong>Audit</strong>: Run data quality checks on the audit branch.</li> <li> <strong>Publish</strong>: The <strong><em>main</em></strong> branch can be <code class="language-plaintext highlighter-rouge">fastForward</code> to the head of the audit <strong><em>branch</em></strong> to update the main table state.</li> </ol> <figure> <picture> <source srcset="/assets/images/articles/28_wap_iceberg_audit_branch.webp" type="image/webp"></source> <img src="/assets/images/articles/28_wap_iceberg_audit_branch.png" alt="example diagram of audit branch" loading="lazy"> </picture> <figcaption>Figure 2: Example Diagram of Audit Branch - <a href="https://iceberg.apache.org/docs/1.6.1/branching/#audit-branch">Image Source</a></figcaption> </figure> <p>Using the WAP pattern, downstream pipelines or dashboards can intuitively depend on the production table directly. However, the main challenges is the introduced delays and increased latency by the multistep process which might not be idea for near real time use cases.</p> <h2 id="change-data-capture-cdc">Change Data Capture (CDC)</h2> <p>Change Data Capture (CDC) is a data integration pattern that captures all changes in a source database; creates, updates and deletes and makes them available for downstream systems.</p> <p>Organizations typically have a variety of operational data spread across different systems and applications needed for running the business. The purpose of CDC is to keep this data synchronized by capturing changes from source databases and moving it to your target data warehouse or data lake.</p> <p>In contrast to batch processing, where a pipeline is scheduled periodically to replicate data from one system to another, CDC is considered more efficient. It eliminates the bulk load during specified windows and enables an incremental loading making the data available in near real time. In addition, it reduces the impact on the source database</p> <p>CDC is typically implemented using two main approaches: <strong>push</strong> and <strong>pull</strong>. In the push approach, the source database pushes the updates to the downstream systems. This has the advantage that the target systems have the latest data in near real time. In the pull approach on the other hand, the source database only logs the changes and it is the responsibility of the target systems to continuously poll it. This results in a delay of the data availability. In both approaches, if the source or target systems are not available for some reason, the data is lost. To overcome this, a messaging system can be used in between to buffer these changes.</p> <p>There are 3 common methods for how changes in data are detected using CDC:</p> <ul> <li>Log-based</li> <li>Timestamp-based</li> <li>Trigger-based</li> </ul> <h3 id="log-based-cdc">Log-based CDC</h3> <p>Transactional databases have internal log files where they record all changes committed against the database. These log files are primarily used for backup and disaster recovery purposes. By reading from these transaction logs we can propagate the changes to target systems without adding computational overhead. However, since each vendor’s logs have a different format, this method can’t be easily reusable.</p> <h3 id="trigger-based-cdc">Trigger-based CDC</h3> <p>Another feature that is widely supported by databases is trigger functions. These are stored procedures that are automatically executed once a specific event occurs on a table. We need to create per table one trigger for each operation and store the data changes in a separate table. This adds additional write operations and might impact the performance of the database. Also managing a large number of triggers can become challenging.</p> <h3 id="timestamp-based-cdc">Timestamp-based CDC</h3> <p>This method requires changes to the database schema to include a timestamp column to record when was an entry last updated. Changes are captured by selecting items with a timestamp newer than the previous check timestamp. Being probably the easiest to implement, it fails at capturing delete operations and could add an additional overhead to the database.</p> <h2 id="dead-letter-queue-dlq">Dead-Letter Queue (DLQ)</h2> <p>In streaming environments, a dead-letter queue is a special message queue used to store messages that were not successfully processed by the primary system. These include corrupted messages due to network or system failure or ones that failed the data quality checks.</p> <p>By having a DLQ in place, we provide a mechanism for analyzing and identifying common patterns of errors enabling better observability in order to improve the reliability of the system. In addition, we can reduce the data loss by reprocessing messages that couldn’t be delivered from the DLQ.</p> <h2 id="cumulative-aggregate-table">Cumulative Aggregate Table</h2> <p>The cumulative aggregate table design pattern is very useful when we want to solve the performance issue that comes with calculating aggregates over a large rolling time window.</p> <p>For example, if we want to calculate the number of active users for the last 30-days window, the straightforward solution would be to write a query that scans <em>30 days of raw event data for <strong>all users</strong> every single day</em>. This query is slow and expensive especially if run regularly.</p> <p>This design pattern proposes a solution to overcome this. The idea is to create a new table that stores the pre-computed state often using arrays or structs. Following the active users example, our table called <code class="language-plaintext highlighter-rouge">user_activity_cumulative</code> will have an array column that is updated daily by performing a <code class="language-plaintext highlighter-rouge">FULL OUTER JOIN</code> between today’s active users and yesterday’s cumulative table.</p> <table> <thead> <tr> <th><strong>user_id</strong></th> <th><strong>date</strong></th> <th><strong>activity_array_last_30_days</strong></th> </tr> </thead> <tbody> <tr> <td>123</td> <td>2025-11-12</td> <td><code class="language-plaintext highlighter-rouge">[1, 0, 1, 0, ..., 0]</code></td> </tr> <tr> <td>456</td> <td>2025-11-12</td> <td><code class="language-plaintext highlighter-rouge">[0, 1, 1, 0, ..., 0]</code></td> </tr> <tr> <td><strong>123</strong></td> <td><strong>2025-11-13</strong></td> <td><strong><code class="language-plaintext highlighter-rouge">[1, 1, 0, 1, ..., 0]</code></strong></td> </tr> <tr> <td><strong>456</strong></td> <td><strong>2025-11-13</strong></td> <td><strong><code class="language-plaintext highlighter-rouge">[0, 0, 1, 1, ..., 0]</code></strong></td> </tr> <tr> <td><strong>789</strong></td> <td><strong>2025-11-13</strong></td> <td><strong><code class="language-plaintext highlighter-rouge">[1, 0, 0, 0, ..., 0]</code></strong></td> </tr> </tbody> </table> <p style="text-align:center;">Table 1: Example of user_activity_cumulative Table</p> <p>Using this new table like shown above, finding out the 30-day active users for November 30th can be done by running the following query:</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">      
   <span class="no">SELECT</span>
     <span class="no">COUNT</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
   <span class="no">FROM</span> <span class="n">user_activity_cumulative</span>
   <span class="no">WHERE</span>
     <span class="n">date</span> <span class="o">=</span> <span class="s1">'2025-11-13'</span>
     <span class="o">--</span> <span class="no">Sum</span> <span class="n">the</span> <span class="mi">30</span> <span class="n">elements</span> <span class="k">in</span> <span class="n">the</span> <span class="n">array</span><span class="p">.</span>
     <span class="nf">-</span><span class="o">-</span> <span class="no">If</span> <span class="n">the</span> <span class="n">sum</span> <span class="n">is</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">they</span> <span class="n">were</span> <span class="n">active</span> <span class="n">at</span> <span class="n">least</span> <span class="n">once</span><span class="o">.</span>
    <span class="no">AND</span> <span class="n">array_sum</span><span class="p">(</span><span class="n">activity_array_last_30_days</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
   
   </code></pre></figure> <p>For more details and concrete hands on example, you can check <a href="https://github.com/DataExpert-io/cumulative-table-design">this repository</a>.</p> <p>With this we have reached the end of this post, I hope you enjoyed it!</p> <p>If you have any remarks or questions, please don’t hesitate and do drop a comment below.</p> <p><em>Stay tuned!</em></p> <h2 id="recap">Recap</h2> <p>In this article, we explored four essential data engineering design patterns that help build reliable and efficient data pipelines. The <strong>Write-Audit-Publish (WAP)</strong> pattern ensures data quality by validating data in a staging area before publishing to production and leveraged Apache Iceberg branches for an example implementation of this pattern. <strong>Change Data Capture (CDC)</strong> enables near real-time data synchronization by capturing incremental changes from source databases using log-based, trigger-based, or timestamp-based methods. <strong>Dead-Letter Queues (DLQ)</strong> provide a safety net for failed messages in streaming systems, improving observability and reducing data loss. Finally, the <strong>Cumulative Aggregate Table</strong> pattern optimizes performance for rolling window calculations by pre-computing and storing state, eliminating the need to scan large amounts of raw data repeatedly.</p> <p><em>Happy learning!</em></p> <h2 id="resources">Resources</h2> <p><a href="https://www.confluent.io/learn/change-data-capture/#why-change-data-capture">https://www.confluent.io/learn/change-data-capture/#why-change-data-capture</a></p> <p><a href="https://aws.amazon.com/blogs/big-data/build-write-audit-publish-pattern-with-apache-iceberg-branching-and-aws-glue-data-quality/">https://aws.amazon.com/blogs/big-data/build-write-audit-publish-pattern-with-apache-iceberg-branching-and-aws-glue-data-quality/</a></p> <p><a href="https://lakefs.io/blog/data-engineering-patterns-write-audit-publish/">https://lakefs.io/blog/data-engineering-patterns-write-audit-publish/</a></p> </div> <br> <div class="ml-embedded" data-form="br5p3i"></div> <br> <hr> <br> <div class="ml-embedded" data-form="T82iSQ"></div> <br> <hr> <br> <div id="relatedPosts"> <div class="post-header bg-"> <h1 class="page-heading">Further Reading</h1> </div> <div id="similar-posts-container"> <div id="similar-posts-loading" style="text-align: center; padding: 20px; color: #6c757d;"> <p>Loading similar posts...</p> </div> <div id="similar-posts-error" style="display: none;"> <p class="no-related">Unable to load recommendations. <a href="/archive/">Explore the archive</a> to discover more articles.</p> </div> <div id="similar-posts-results"></div> </div> <div id="tag-based-related" style="display: none;"> <div class="related-post-item"> <h3><a href="/articles/2025/10/24/serverless-architecture-for-data-engineering.html">Serverless Architecture for Data Engineering</a></h3> <p class="related-meta"> <span class="related-date">October 24, 2025</span> <span class="related-tags"> <span class="tag-badge">Data Engineering</span> <span class="tag-badge">Data Architecture</span> </span> </p> </div> <div class="related-post-item"> <h3><a href="/articles/2024/11/17/evolution-analytical-data-architectures.html">Evolution of Analytical Data Architectures: From Data Warehouses to Lakehouses</a></h3> <p class="related-meta"> <span class="related-date">November 17, 2024</span> <span class="related-tags"> <span class="tag-badge">Data Engineering</span> <span class="tag-badge">Data Architecture</span> </span> </p> </div> <div class="related-post-item"> <h3><a href="/articles/2024/08/11/data-warehouse-modeling-techniques.html">Data Warehouse Modeling Techniques</a></h3> <p class="related-meta"> <span class="related-date">August 11, 2024</span> <span class="related-tags"> <span class="tag-badge">Data Engineering</span> <span class="tag-badge">Data Architecture</span> </span> </p> </div> <div class="related-post-item"> <h3><a href="/articles/2023/09/24/data-processing-architectures-lambda-vs-kappa.html">Data Processing Architectures: Lambda vs Kappa</a></h3> <p class="related-meta"> <span class="related-date">September 24, 2023</span> <span class="related-tags"> <span class="tag-badge">Data Engineering</span> <span class="tag-badge">Data Architecture</span> </span> </p> </div> </div> </div> <script>!function(){"use strict";async function t(){const t=document.getElementById("similar-posts-loading"),s=(document.getElementById("similar-posts-error"),document.getElementById("similar-posts-results")),r=document.getElementById("tag-based-related"),l=`similar_posts_${i}`,c=6048e5;try{const n=localStorage.getItem(l);if(n){const{posts:a,timestamp:o}=JSON.parse(n);if(Date.now()-o<c)return t.style.display="none",void e(a,s)}}catch(t){console.log("Cache read failed:",t)}const d=new AbortController,m=setTimeout(()=>d.abort(),o);try{const o=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:i,limit:a}),signal:d.signal});if(clearTimeout(m),!o.ok)throw new Error(`HTTP ${o.status}`);const r=await o.json();if(t.style.display="none",r.similar_posts&&r.similar_posts.length>0){e(r.similar_posts,s);try{localStorage.setItem(l,JSON.stringify({posts:r.similar_posts,timestamp:Date.now()}))}catch(t){console.log("Cache write failed:",t)}}else s.innerHTML='<p class="no-related">No related posts found. <a href="/archive/">Explore the archive</a> to discover more articles.</p>'}catch(e){clearTimeout(m),console.error("Error loading similar posts:",e),t.style.display="none",r.style.display="block"}}function e(t,e){const s=t.map(t=>{const e=new Date(t.date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),s=t.tags&&t.tags.length>0?t.tags.map(t=>`<span class="tag-badge">${t}</span>`).join(" "):"",n=Math.round(100*t.score);return`\n        <div class="related-post-item">\n          <h3><a href="${t.url}">${t.title}</a></h3>\n          <p class="related-meta">\n            <span class="related-date">${e}</span>\n            ${s?`<span class="related-tags">${s}</span>`:""}\n            <span class="similarity-score" title="Similarity: ${n}%">\n              <svg width="12" height="12" style="vertical-align: middle; margin-left: 8px;">\n                <circle cx="6" cy="6" r="5" fill="none" stroke="#007bff" stroke-width="1.5"/>\n                <circle cx="6" cy="6" r="5" fill="none" stroke="#007bff" stroke-width="1.5" \n                        stroke-dasharray="${.314*n} 31.4" \n                        stroke-dashoffset="7.85" \n                        transform="rotate(-90 6 6)"/>\n              </svg>\n              ${n}% match\n            </span>\n          </p>\n        </div>\n      `}).join("");e.innerHTML=s}function s(){const e=document.getElementById("relatedPosts");if("IntersectionObserver"in window){const s=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(t(),s.disconnect())})},{rootMargin:"200px"});s.observe(e)}else t()}const n="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"http://localhost:8080/api/v1/similar":"https://api.firasesbai.com/api/v1/similar",a=4,o=3e4,i="https://www.firasesbai.com/articles/2025/11/13/data-engineering-design-patterns.html";"loading"===document.readyState?document.addEventListener("DOMContentLoaded",s):s()}();</script> <hr> <br> <div id="disqus_thread"></div> <script>!function(){var e=document,t=e.createElement("script");t.src="https://firasesbai.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)}();</script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript> <a class="u-url" href="/articles/2025/11/13/data-engineering-design-patterns.html" hidden></a> </article> <script src="/js/reading-progress.js" defer></script> <script src="/js/code-copy.js" defer></script> </div> </main><footer class="site-footer h-card"> <data class="u-url" href="/"></data> <div class="wrapper"> <div class="footer-col-wrapper"> <div class="footer-col footer-col-1" style="text-align: left;"><ul class="social-media-list"> <li><a href="https://www.firasesbai.com/feed.xml"><svg class="svg-icon orange"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg><span> Subscribe</span></a></li> <li><a href="https://www.linkedin.com/in/firas-esbai"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">firas-esbai</span></a></li> <li><a href="https://github.com/firasesbai"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">firasesbai</span></a></li> </ul></div> <div class="footer-col footer-col-2" style="text-align: right;"> <ul class="legal-list" style="list-style-type: none; padding: 0;"> <li><a href="/archive/">Archive</a></li> <li><a href="/privacy-policy/">Privacy Policy</a></li> <li><a href="/terms/">Terms and Conditions</a></li> </ul> </div> </div> <div style="text-align: center; margin-top: 10px;"> <p class="p-name">Copyright © 2025 Firas Esbai.</p> </div> </div> </footer> <script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false" defer></script> <script src="/js/cookie-consent-script.js" type="text/javascript" defer></script> </body> </html>