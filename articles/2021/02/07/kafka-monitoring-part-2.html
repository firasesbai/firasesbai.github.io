<!DOCTYPE html>
<html lang="en">
  
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" /><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Essential Kafka Cluster Metrics: A Comprehensive Monitoring Guide | Firas Esbai</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Essential Kafka Cluster Metrics: A Comprehensive Monitoring Guide" />
<meta name="author" content="Firas Esbai" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Explanation of important metrics and their usage for Apache Kafka Monitoring" />
<meta property="og:description" content="Explanation of important metrics and their usage for Apache Kafka Monitoring" />
<link rel="canonical" href="https://www.firasesbai.com/articles/2021/02/07/kafka-monitoring-part-2.html" />
<meta property="og:url" content="https://www.firasesbai.com/articles/2021/02/07/kafka-monitoring-part-2.html" />
<meta property="og:site_name" content="Firas Esbai" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-02-07T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Essential Kafka Cluster Metrics: A Comprehensive Monitoring Guide" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Firas Esbai"},"description":"Explanation of important metrics and their usage for Apache Kafka Monitoring","headline":"Essential Kafka Cluster Metrics: A Comprehensive Monitoring Guide","url":"https://www.firasesbai.com/articles/2021/02/07/kafka-monitoring-part-2.html","@type":"BlogPosting","dateModified":"2021-02-07T00:00:00+00:00","datePublished":"2021-02-07T00:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.firasesbai.com/articles/2021/02/07/kafka-monitoring-part-2.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://www.firasesbai.com/feed.xml" title="Firas Esbai" /><!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id='G-3ET85T3WD3'"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3ET85T3WD3');
</script>
</head>
<!-- insert favicons. use https://realfavicongenerator.net/ -->
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png?v=1">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png?v=1">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png?v=1">
  <link rel="manifest" href="/assets/favicon/site.webmanifest">
  <link rel="mask-icon" href="/assets/favicon/safari-pinned-tab.svg?v=1" color="#5bbad5">
  <link rel="shortcut icon" href="/assets/favicon/favicon.ico?v=1">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">

  <!-- service Worker Logic -->	
  <script type="text/javascript" src="/js/service-worker.js"></script>
  
  
  	<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id='G-3ET85T3WD3'"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3ET85T3WD3');
</script>

  
  
  <body><header class="site-header" role="banner">
   <div class="wrapper"><a class="site-title" href="/" style="font-size: 26px"> Home </a><nav class="site-nav">
         <input type="checkbox" id="nav-trigger" class="nav-trigger" />
         <label for="nav-trigger">
            <span class="menu-icon">
               <svg viewBox="0 0 18 15" width="18px" height="15px">
                  <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
               </svg>
            </span>
         </label>
         <div class="trigger">
            <!--
               my_page.autogen is populated by the pagination logic for all pages
                               that are automatically created by the gem. Check for non-existence to exclude pagination pages from site.pages iterators
               -->
            
            
            
            
            <a class="page-link" href="/about.html" style="font-size: 20px">About Me</a>
            
            
            
            <a class="page-link" href="/archive.html" style="font-size: 20px">Archive</a>
            
            
            
            
            
            
            
            <a class="page-link" href="/contact.html" style="font-size: 20px">Contact Me</a>
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            

         </div>
      </nav></div>
</header><main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Essential Kafka Cluster Metrics: A Comprehensive Monitoring Guide</h1>
    <p class="post-meta"><time class="dt-published" datetime="2021-02-07T00:00:00+00:00" itemprop="datePublished">
        Feb 7, 2021 - 
      </time>
	  
	  <span class="reading-time" title="Estimated read time">
  
  4 min read
</span>
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name"> - Firas Esbai</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p><em>In this article we will stop by some of the most important metrics that we need to keep an eye on while monitoring an Apache Kafka cluster.</em></p>

<p>This is a follow-up article on the Kafka monitoring topic where we started by setting up the necessary infrastructure to monitor an Apache Kafka cluster running in a production environment.</p>

<p>If you have missed the first part, you can find it <a href="https://firasesbai.github.io/articles/2021/01/01/kafka-monitoring.html">here</a>.</p>

<p>The key metrics we are interested in can be grouped into the following categories:</p>

<ul>
  <li><em>Broker Server Metrics</em></li>
  <li><em>Broker Topics Metrics</em></li>
  <li><em>Broker Requests Metrics</em></li>
</ul>

<hr />

<h1> Contents </h1>
<ul id="markdown-toc">
  <li><a href="#broker-server-metrics" id="markdown-toc-broker-server-metrics">Broker Server Metrics</a></li>
  <li><a href="#broker-topics-metrics" id="markdown-toc-broker-topics-metrics">Broker Topics Metrics</a></li>
  <li><a href="#broker-requests-metrics" id="markdown-toc-broker-requests-metrics">Broker Requests Metrics</a></li>
  <li><a href="#recap" id="markdown-toc-recap">Recap</a></li>
  <li><a href="#resources" id="markdown-toc-resources">Resources</a></li>
</ul>
<hr />

<h2 id="broker-server-metrics">Broker Server Metrics</h2>

<p>While it is important to collect and record the values of these metrics, an <strong>alerting mechanism</strong> needs to be put in place, in order to receive notifications mainly for the critical ones.</p>

<table>
  <thead>
    <tr>
      <th>Metric Name</th>
      <th style="text-align: left">Description</th>
      <th style="text-align: left">Alert</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>UnderReplicatedPartitions</td>
      <td style="text-align: left">Number of under-replicated partitions (<code class="language-plaintext highlighter-rouge">ISR* &lt; all replicas</code>). Normal value 0.</td>
      <td style="text-align: left">Alert if value is greater than 0</td>
    </tr>
    <tr>
      <td>OfflinePartitionsCount</td>
      <td style="text-align: left">Number of partitions that don’t have an active leader and are hence not writable or readable.</td>
      <td style="text-align: left">Alert if value is greater than 0</td>
    </tr>
    <tr>
      <td>UnderMinIsr</td>
      <td style="text-align: left">Number of partitions whose ISR count is less than <code class="language-plaintext highlighter-rouge">minIsr</code>. Normal value 0.</td>
      <td style="text-align: left">-</td>
    </tr>
    <tr>
      <td>LeaderElectionRateAndTimeMs</td>
      <td style="text-align: left">Leader election rate and latency. Non-zero when there are broker failures.</td>
      <td style="text-align: left">-</td>
    </tr>
    <tr>
      <td>UncleanLeaderElectionsPerSec</td>
      <td style="text-align: left">Unclean leader election rate. Normal value 0.</td>
      <td style="text-align: left">Alert when value is different than 0</td>
    </tr>
    <tr>
      <td>PartitionCount</td>
      <td style="text-align: left">Number of partitions on this broker. This should be mostly even across all brokers.</td>
      <td style="text-align: left">-</td>
    </tr>
    <tr>
      <td>LeaderCount</td>
      <td style="text-align: left">Number of leaders on this broker. This should be mostly even across all brokers. If not, set <code class="language-plaintext highlighter-rouge">auto.leader.rebalance.enable</code> to true on all brokers in the cluster.</td>
      <td style="text-align: left">-</td>
    </tr>
    <tr>
      <td>MaxLag</td>
      <td style="text-align: left">Maximum lag in messages between the follower and leader replicas. This is controlled by the <code class="language-plaintext highlighter-rouge">replica.lag.max.messages</code> config. Lag should be proportional to the maximum batch size of a produce request. If a broker goes down, ISR for some of the partitions will shrink. When that broker is up again, ISR will be expanded once the replicas are fully caught up. Other than that, the expected value for both ISR shrink rate and expansion rate is 0.</td>
      <td style="text-align: left">-</td>
    </tr>
    <tr>
      <td>IsrExpandsPerSec</td>
      <td style="text-align: left">When a broker is brought up after a failure, it starts catching up by reading from the leader. Once it is caught up, it gets added back to the ISR.</td>
      <td style="text-align: left">-</td>
    </tr>
    <tr>
      <td>ConsumerLag</td>
      <td style="text-align: left">Lag in number of messages per follower replica. This is useful to know if the replica is slow or has stopped replicating from the leader.</td>
      <td style="text-align: left">-</td>
    </tr>
  </tbody>
</table>

<p><em>*ISR: In-Sync Replica</em></p>
<h2 id="broker-topics-metrics">Broker Topics Metrics</h2>

<table>
  <thead>
    <tr>
      <th>Metric Name</th>
      <th style="text-align: center">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>BytesInPerSec</td>
      <td style="text-align: center">Aggregate incoming byte in rate from clients.</td>
    </tr>
    <tr>
      <td>BytesOutPerSec</td>
      <td style="text-align: center">Aggregate outgoing byte out rate from clients.</td>
    </tr>
    <tr>
      <td>TotalProduceRequestsPerSec</td>
      <td style="text-align: center">Produce request rate.</td>
    </tr>
    <tr>
      <td>FailedProduceRequestsPerSec</td>
      <td style="text-align: center">Produce request rate for requests that failed.</td>
    </tr>
    <tr>
      <td>TotalFetchRequestsPerSec</td>
      <td style="text-align: center">Fetch request rate.</td>
    </tr>
    <tr>
      <td>FailedFetchRequestsPerSec</td>
      <td style="text-align: center">Fetch request rate for requests that failed.</td>
    </tr>
  </tbody>
</table>

<h2 id="broker-requests-metrics">Broker Requests Metrics</h2>

<table>
  <thead>
    <tr>
      <th>Metric Name</th>
      <th style="text-align: center">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>RequestQueueSize</td>
      <td style="text-align: center">Size of the request queue. A congested request queue will not be able to process incoming or outgoing requests.</td>
    </tr>
    <tr>
      <td>TotalTimeMs</td>
      <td style="text-align: center">Total time in ms to serve the specified request broken into queue, local, remote and response send time.</td>
    </tr>
    <tr>
      <td>RequestQueueTimeMs</td>
      <td style="text-align: center">Time the request waits in the request queue.</td>
    </tr>
    <tr>
      <td>LocalTimeMs</td>
      <td style="text-align: center">Time the request is processed at the leader.</td>
    </tr>
    <tr>
      <td>RemoteTimeMs</td>
      <td style="text-align: center">Time the request waits for the follower. This is non-zero for produce requests when acks=all.</td>
    </tr>
    <tr>
      <td>ResponseQueueTimeMs</td>
      <td style="text-align: center">Time the request waits in the response queue.</td>
    </tr>
    <tr>
      <td>ResponseSendTimeMs</td>
      <td style="text-align: center">Time to send the response.</td>
    </tr>
    <tr>
      <td>PurgatorySize, delayedOperation=Produce</td>
      <td style="text-align: center">Number of requests waiting in the producer purgatory. This should be non-zero when <code class="language-plaintext highlighter-rouge">acks=all</code> is used on the producer.</td>
    </tr>
    <tr>
      <td>PurgatorySize, delayedOperation=Fetch</td>
      <td style="text-align: center">Number of requests waiting in the fetch purgatory. This is high if consumers use a large value for <code class="language-plaintext highlighter-rouge">fetch.wait.max.ms</code>.</td>
    </tr>
  </tbody>
</table>

<p>In this Github <a href="https://github.com/firasesbai/Monitoring-Kafka">repository</a> you can find a set of ready to use <strong>Grafana dashboards</strong> (see example below) populated with all the discussed above metrics that should serve as a starting point for you to quickly set up a tracking and alerting mechanism for your cluster.</p>

<p><img src="/assets/images/articles/2_grafana_dashboard.png" alt="image" />
<br /> <em>Figure 1: Grafana Dashboard for Kafka Cluster Monitoring</em></p>

<p>With this we have reached the end of this post, I hope you enjoyed it!</p>

<p>The list of metrics mentioned here is not an exhaustive one and probably you will change or extend it depending on your use case and needs.</p>

<p>This is why it might be a good idea to check out the list of the resources below for a wider and more in-depth view especially if you’re looking for additional metrics related to other components like Zookeeper or your Consumers and Producers.</p>

<h2 id="recap">Recap</h2>

<p>In this article we went through some of the most important metrics that we need to observe while monitoring an Apache Kafka cluster.</p>

<p><em>Happy learning!</em></p>

<h2 id="resources">Resources</h2>

<p><a href="https://docs.confluent.io/current/kafka/monitoring.html">https://docs.confluent.io/current/kafka/monitoring.html</a></p>

<p><a href="https://blog.serverdensity.com/how-to-monitor-kafka/">https://blog.serverdensity.com/how-to-monitor-kafka/</a></p>

<p><a href="https://www.datadoghq.com/blog/monitoring-kafka-performance-metrics/">https://www.datadoghq.com/blog/monitoring-kafka-performance-metrics/</a></p>


  </div>

  <hr>
<br>
<script async data-uid="303d8467ac" src="https://firas-esbai.ck.page/303d8467ac/index.js"></script>


  <br>
<hr>
<br>
<div id="relatedPosts">
   <div class="post-header bg-">
      <h1 class="page-heading">Further Reading</h1>
   </div>
   
   
   
   
   
    
    
    
   
    
   
    
    
    
   
    
   
    
    
    
   
    
   
    
    
    
   
    
   
    
    
    
   
    
   
    
    
    
   
    
   
    
    
    
   
    
   
    
    
    
   
    
   
    
    
    
   
    
    <div>
      <h3><a href="/articles/2023/01/15/prometheus-monitoring.html">Prometheus Monitoring: How to Collect and Analyze Metrics</a></h3>
    </div>
    
    
   
   
    
    
    
   
    
   
    
    
    
   
    
   
    
    
    
   
    
   
    
    
    
   
    
   
    
    
    
   
    
   
    
    
    
   
    
    <div>
      <h3><a href="/articles/2022/01/09/logging-with-elasticsearch.html">Logging with ELK Stack</a></h3>
    </div>
    
    
   
   
    
    
    
   
    
   
    
    
    
   
    
   
    
    
    
   
    
   
    
    
    
   
    
    <div>
      <h3><a href="/articles/2021/01/01/kafka-monitoring.html">Navigating Apache Kafka Monitoring in Real-World Deployments</a></h3>
    </div>
    
    
   
   
</div>

  
    
<hr>
<br>
<div id="disqus_thread"></div>
<script>
    /**
    *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
    *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://firasesbai.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  

  <a class="u-url" href="/articles/2021/02/07/kafka-monitoring-part-2.html" hidden></a>
</article>
      </div>
    </main><style>
   .legal-list {
      list-style-type: none;
   }
</style>
 
<footer class="site-footer h-card">
   <data class="u-url" href="/"></data>
   <div class="wrapper">
      <div class="footer-col-wrapper">
         <div class="footer-col footer-col-1"><ul class="social-media-list"><li><a href="https://www.firasesbai.com/feed.xml"><svg class="svg-icon orange"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg><span> Subscribe</span></a></li><li><a href="https://www.linkedin.com/in/firas-esbai"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">firas-esbai</span></a></li><li><a href="https://github.com/firasesbai"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">firasesbai</span></a></li></ul></div>
         <div align="right">
               <ul class="legal-list">
                  <li class="p-name">Copyright &copy 2024 Firas Esbai.</li>
                  <li><a href="/terms/"> Terms and Conditions </a></li>
                  <li><a href="/privacy-policy/"> Privacy Policy </a></li>
               </ul>
         </div>
      </div>
   </div>
</footer><!-- Cookie Consent Logic -->	
	<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script>
	<script src="/js/cookie-consent-script.js" type="text/javascript"> </script>

  </body>

</html>