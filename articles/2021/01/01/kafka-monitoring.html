<!DOCTYPE html>
<html lang="en">
  
  <!-- Cookie Consent CSS -->
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" />

  <!-- D3js -->
  <script src="https://d3js.org/d3.v7.min.js"></script>

<!-- MailerLite Universal -->
<script>
  (function(w,d,e,u,f,l,n){w[f]=w[f]||function(){(w[f].q=w[f].q||[])
  .push(arguments);},l=d.createElement(e),l.async=1,l.src=u,
  n=d.getElementsByTagName(e)[0],n.parentNode.insertBefore(l,n);})
  (window,document,'script','https://assets.mailerlite.com/js/universal.js','ml');
  ml('account', '1240462');
</script>
<!-- End MailerLite Universal --><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Navigating Apache Kafka Monitoring in Real-World Deployments | Firas Esbai</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Navigating Apache Kafka Monitoring in Real-World Deployments" />
<meta name="author" content="Firas Esbai" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Detailed explanation with code examples for Apache Kafka cluser monitoring using Prometheus and Grafana dashboards" />
<meta property="og:description" content="Detailed explanation with code examples for Apache Kafka cluser monitoring using Prometheus and Grafana dashboards" />
<link rel="canonical" href="https://www.firasesbai.com/articles/2021/01/01/kafka-monitoring.html" />
<meta property="og:url" content="https://www.firasesbai.com/articles/2021/01/01/kafka-monitoring.html" />
<meta property="og:site_name" content="Firas Esbai" />
<meta property="og:image" content="https://www.firasesbai.com/assets/images/articles/1_kafka_monitoring_architecture.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-01-01T00:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://www.firasesbai.com/assets/images/articles/1_kafka_monitoring_architecture.png" />
<meta property="twitter:title" content="Navigating Apache Kafka Monitoring in Real-World Deployments" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Firas Esbai"},"dateModified":"2021-01-01T00:00:00+00:00","datePublished":"2021-01-01T00:00:00+00:00","description":"Detailed explanation with code examples for Apache Kafka cluser monitoring using Prometheus and Grafana dashboards","headline":"Navigating Apache Kafka Monitoring in Real-World Deployments","image":"https://www.firasesbai.com/assets/images/articles/1_kafka_monitoring_architecture.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.firasesbai.com/articles/2021/01/01/kafka-monitoring.html"},"url":"https://www.firasesbai.com/articles/2021/01/01/kafka-monitoring.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://www.firasesbai.com/feed.xml" title="Firas Esbai" /><!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id='G-3ET85T3WD3'"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3ET85T3WD3');
</script>
</head>
<!-- insert favicons. use https://realfavicongenerator.net/ -->
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png?v=1">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png?v=1">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png?v=1">
  <link rel="manifest" href="/assets/favicon/site.webmanifest">
  <link rel="mask-icon" href="/assets/favicon/safari-pinned-tab.svg?v=1" color="#5bbad5">
  <link rel="shortcut icon" href="/assets/favicon/favicon.ico?v=1">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">

  <!-- service Worker Logic -->	
  <script type="text/javascript" src="/js/service-worker.js"></script>
  
  
  	<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id='G-3ET85T3WD3'"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3ET85T3WD3');
</script>

  
  
  <body><header class="site-header" role="banner">
   <div class="wrapper"><a class="site-title" href="/" style="font-size: 26px"> Firas Esbai </a><nav class="site-nav">
         <input type="checkbox" id="nav-trigger" class="nav-trigger" />
         <label for="nav-trigger">
            <span class="menu-icon">
               <svg viewBox="0 0 18 15" width="18px" height="15px">
                  <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
               </svg>
            </span>
         </label>
         <div class="trigger">
            <!--
               my_page.autogen is populated by the pagination logic for all pages
                               that are automatically created by the gem. Check for non-existence to exclude pagination pages from site.pages iterators
               -->
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
            
               
                  <a class="page-link" href="/blog/index.html" style="font-size: 20px">Blog</a>
               
            
               
                  <a class="page-link" href="/contact/" style="font-size: 20px">Contact Me</a>
               
            

         </div>
      </nav></div>
</header><main class="page-content" aria-label="Content">
      <div class="wrapper">
        <link rel="stylesheet" href="/assets/css/post.css">

<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <nav aria-label="breadcrumb">
    <p class="breadcrumb">
      <a href="/blog">Blog</a>
      
        
        
        > <a href="/categories/observability">Observability</a>
      
      > <span>Navigating Apache Kafka Monitoring in Real-World Deployments</span>
    </p>
  </nav>

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Navigating Apache Kafka Monitoring in Real-World Deployments</h1>
    <p class="post-meta"><time class="dt-published" datetime="2021-01-01T00:00:00+00:00" itemprop="datePublished">
        Jan 1, 2021 - 
      </time>
      
      <span class="reading-time" title="Estimated read time">
  
  6 min read
</span>
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name"> - Firas Esbai</span></span></p></header>

  <div class="post-content e-content" itemprop="articleBody">
    <p><em>In this article we will discuss monitoring Apache Kafka in a production environment.</em></p>

<p>If you’re just starting to use Apache Kafka or maybe thinking about it (convincing you to start right away would require another post, but you should anyway), then probably monitoring it might have not even crossed your mind or seemed that important to you at the beginning.</p>

<p>However, as your cluster grows and you are dealing with an increasing number of different consumers, producers, connectors and constantly worrying about your Zookeeper cluster (although it was recently removed in the new release) then make yourself comfortable and keep reading; <em>you’re in the right place!</em></p>

<p>Believe me when I tell you that this is actually a full time job and we are only going to scratch the surface. The rest is up to you.</p>

<p>That being said, this process could turn out to be very easy and more efficient by applying one of the existing solutions out there like the confluent control center which is part of the confluent platform. That’s awesome! Yet, I’m sure you already have guessed that it is not part of the community edition and you have of course to pay for it.</p>

<p>But, if you like to get your hands dirty and build your own monitoring solution using open source tools then let’s get started already.</p>

<p><strong>All the source code is available <a href="https://github.com/firasesbai/Monitoring-Kafka">here</a>.</strong></p>

<hr />

<h1> Contents </h1>
<ul id="markdown-toc">
  <li><a href="#what-is-apache-kafka" id="markdown-toc-what-is-apache-kafka">What is Apache Kafka?</a></li>
  <li><a href="#what-is-prometheus" id="markdown-toc-what-is-prometheus">What is Prometheus?</a></li>
  <li><a href="#what-is-jmx-exporter" id="markdown-toc-what-is-jmx-exporter">What is JMX-Exporter?</a></li>
  <li><a href="#what-is-grafana" id="markdown-toc-what-is-grafana">What is Grafana?</a></li>
  <li><a href="#recap" id="markdown-toc-recap">Recap</a></li>
  <li><a href="#resources" id="markdown-toc-resources">Resources</a></li>
</ul>
<hr />

<p><em>First let’s start with the basics.</em></p>

<h2 id="what-is-apache-kafka">What is Apache Kafka?</h2>

<p>Apache Kafka is a distributed messaging queue system created by LinkedIn in 2011 and now an Open Source Project mainly maintained by Confluent the company founded by its original developers. It has then quickly evolved to a full-fledged event streaming platform.</p>

<p>It is based on a distributed, fault tolerant and resilient architecture. It allows decoupling of source systems, called <code class="language-plaintext highlighter-rouge">Producers</code> and target systems; the <code class="language-plaintext highlighter-rouge">Consumers</code>. Thus, not only simplifying the topology of your application but also handling millions of messages per seconds by horizontally scaling up to 100 brokers and still maintaining high performance and latency of less than 10ms making it widely adopted by many companies and the de facto platform for real time data processing.</p>

<figure>
  <img src="/assets/images/articles/1_apache_kafka.png" alt="Apache Kafka usage and integrations" />
  <figcaption>Figure 1: Apache Kafka - <a href="https://developer.confluent.io/what-is-apache-kafka/">Image Source</a></figcaption>
</figure>

<h2 id="what-is-prometheus">What is Prometheus?</h2>
<p>Prometheus is an open source monitoring and alerting toolkit. It is based on a <code class="language-plaintext highlighter-rouge">pull model</code>; collecting metrics from monitored targets and therefore alleviating them from a lot of workload.</p>

<p>Target systems make their metrics available by exposing an HTTP endpoint, usually <code class="language-plaintext highlighter-rouge">/metrics</code>. Prometheus then scrapes these endpoints at a regular interval to get the current state of values of the clients’ metrics and persists them to its time-series database.</p>

<p>In addition to the collected metrics, Prometheus will create an additional one called <code class="language-plaintext highlighter-rouge">up</code>, which will be set to 1 if the last scrape is successful, or 0 otherwise.</p>

<p>Most programming languages have a Prometheus client library that lets you define and expose internal metrics via an HTTP endpoint on your application’s instance. However, in the case when it is not feasible to instrument a given system with Prometheus metrics directly, <code class="language-plaintext highlighter-rouge">exporters</code> are the solution for you. In fact, there are a number of exporters which help in exporting metrics from third-party systems as Prometheus metrics. For example, the Prometheus Node Exporter exposes a wide variety of hardware- and kernel-related metrics.</p>

<p>Another example of exporters would be the <code class="language-plaintext highlighter-rouge">JMX Exporter</code> which we will discuss in details in the next section. In addition, we will also use a <code class="language-plaintext highlighter-rouge">Kafka Exporter</code> which is an open-source project that can be found here <a href="https://github.com/danielqsj/kafka_exporter">kafka_exporter</a> for some Kafka cluster related metrics.</p>

<h2 id="what-is-jmx-exporter">What is JMX-Exporter?</h2>

<p>Java Management Extensions (JMX) is a Java technology that supplies tools for managing and monitoring applications. It is a common technology in Java for exporting statistics of running applications.</p>

<p>For instance Kafka brokers expose their metrics through JMX. Therefore, by using JMX Exporter which can export from a wide variety of JVM-based applications, we can automatically collect metrics from Kafka and exposes them over HTTP in a read-only mode for Prometheus.</p>

<p>This exporter is strongly encouraged to be run as a java agent running inside the same JVM of the target system even though it can be run as an independent HTTP server since the latter configuration comes with many disadvantages such as being harder to configure and being unable to expose process metrics (e.g., memory and CPU usage).</p>

<h2 id="what-is-grafana">What is Grafana?</h2>
<p>Grafana allows you to query, visualize, alert on and understand your metrics no matter where they are stored. Through the various visualizations options you’ll be able to not only create dashboards but also share them with the community and discover hundreds more off the shelf for you to be used. It supports dozens of data sources all in one place where you can correlate, explore, define alerts where it makes sense and foster a data driven culture.</p>

<p>Now after looking at each component separately, the most important question is:
<em>how can we put all the above mentioned tools to create our monitoring platform?</em></p>

<p>Below is a diagram showing the different tools and the interactions between them:</p>

<figure>
  <img src="/assets/images/articles/1_kafka_monitoring_architecture.png" alt="Diagram showing how to monitor Apache Kafka" />
  <figcaption>Figure 2: Apache Kafka Monitoring Architecture</figcaption>
</figure>

<p>Following are the main steps to set this topology up:</p>
<ul>
  <li>
    <p>From <a href="https://github.com/prometheus/jmx_exporter">jmx_exporter</a> download JMX Exporter’s <strong>jar</strong> and <strong>configuration files</strong> for <em>Kafka</em> and <em>Zookeeper</em> respectively.
These configuration files contain rules for rewriting JMX MBeans to the Prometheus exposition format metrics. Basically, it’s a collection of regexps to convert MBeans strings to Prometheus strings.</p>
  </li>
  <li>
    <p>Add the following environment variable to each one of your Kafka nodes:</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">KAFKA_OPTS</span><span class="p">:</span> <span class="o">-</span><span class="n">javaagent</span><span class="ss">:/</span><span class="n">usr</span><span class="o">/</span><span class="n">jmx_prometheus_javaagent</span><span class="o">-</span><span class="mf">0.10</span><span class="p">.</span><span class="nf">jar</span><span class="o">=</span><span class="mi">7071</span><span class="ss">:/</span><span class="n">usr</span><span class="o">/</span><span class="n">prom</span><span class="o">-</span><span class="n">jmx</span><span class="o">-</span><span class="n">agent</span><span class="o">-</span><span class="n">kafka</span><span class="o">-</span><span class="n">config</span><span class="p">.</span><span class="nf">yml</span></code></pre></figure>

<ul>
  <li>Add the following environment variable to your Zookeeper node:</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">JVMFLAGS</span><span class="p">:</span> <span class="s2">"-javaagent:/usr/jmx_prometheus_javaagent-0.10.jar=7000:/usr/prom-jmx-agent-zoo-config.yml"</span></code></pre></figure>

<ul>
  <li>Add the downloaded files to the corresponding containers and restart them.</li>
  <li>Start the Kafka Exporter Container by configuring the IP addresses or host names of your Kafka nodes:</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="ss">command: </span><span class="s2">"--kafka.server=kafka-1:9092 --kafka.server=kafka-2:9093 --kafka.server=kafka-3:9094"</span></code></pre></figure>

<ul>
  <li>Start Prometheus and Grafana with the provisioned dashboards.</li>
  <li>Log in to your Grafana instance and configure Prometheus as a data source. You should be able to see the several dashboards populated with a lot of metrics about your cluster.</li>
</ul>

<p>With this we have reached the end of this post, I hope you enjoyed it!</p>

<p>An important aspect is yet to be covered in a separate follow up article which deals with the description and interpretation of the different metrics and the most important ones to keep an eye on and what are the appropriate actions to take in certain situations to keep a healthy running Kafka cluster.</p>

<p><em>Stay tuned!</em></p>

<h2 id="recap">Recap</h2>

<p>In this article we discussed the building blocks and the interaction between them to set up an open source monitoring solution for a running Kafka cluster and ecosystem.</p>

<p><em>Happy learning!</em></p>

<h2 id="resources">Resources</h2>

<p><a href="https://www.confluent.io/what-is-apache-kafka">https://www.confluent.io/what-is-apache-kafka</a></p>

<p><a href="https://prometheus.io/docs/introduction/overview">https://prometheus.io/docs/introduction/overview/</a></p>

<p><a href="https://grafana.com/grafana/">https://grafana.com/grafana/</a></p>

  </div>

  <hr>
<br>
<div class="ml-embedded" data-form="T82iSQ"></div>

  <br>
<hr>
<br>
<div id="relatedPosts">
   <div class="post-header bg-">
      <h1 class="page-heading">Further Reading</h1>
   </div>
   
   
   
   
   
    
    
    
   
    
   
    
    
    
   
    
   
    
    
    
   
    
   
    
    
    
   
    
   
    
    
    
   
    
   
    
    
    
   
    
   
    
    
    
   
    
   
    
    
    
   
    
   
    
    
    
   
    
   
    
    
    
   
    
   
    
    
    
   
    
   
    
    
    
   
    
   
    
    
    
   
    
   
    
    
    
   
    
   
    
    
    
   
    
   
    
    
    
   
    
   
    
    
    
   
    
   
    
    
    
   
    
   
    
    
    
   
    
    <div>
      <h3><a href="/articles/2023/01/15/prometheus-monitoring.html">Prometheus Monitoring: How to Collect and Analyze Metrics</a></h3>
    </div>
    
    
   
   
    
    
    
   
    
   
    
    
    
   
    
   
    
    
    
   
    
    <div>
      <h3><a href="/articles/2022/01/09/logging-with-elasticsearch.html">Logging with ELK Stack</a></h3>
    </div>
    
    
   
   
    
    
    
   
    
   
    
    
    
   
    
   
    
    
    
   
    
    <div>
      <h3><a href="/articles/2021/02/07/kafka-monitoring-part-2.html">Essential Kafka Cluster Metrics: A Comprehensive Monitoring Guide</a></h3>
    </div>
    
    
   
   
    
    
    
   
    
   
</div>

  
    
<hr>
<br>
<div id="disqus_thread"></div>
<script>
    /**
    *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
    *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://firasesbai.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  

  <a class="u-url" href="/articles/2021/01/01/kafka-monitoring.html" hidden></a>
</article>
      </div>
    </main><link rel="stylesheet" href="/assets/css/footer.css">
 
<footer class="site-footer h-card">
   <data class="u-url" href="/"></data>
   <div class="wrapper">
      <div class="footer-col-wrapper">
         <div class="footer-col footer-col-1" style="text-align: left;"><ul class="social-media-list"><li><a href="https://www.firasesbai.com/feed.xml"><svg class="svg-icon orange"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg><span> Subscribe</span></a></li><li><a href="https://www.linkedin.com/in/firas-esbai"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">firas-esbai</span></a></li><li><a href="https://github.com/firasesbai"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">firasesbai</span></a></li></ul></div>
         <div class="footer-col footer-col-2" style="text-align: right;">
            <ul class="legal-list" style="list-style-type: none; padding: 0;">
               <li><a href="/archive/">Archive</a></li>
               <li><a href="/privacy-policy/">Privacy Policy</a></li>
               <li><a href="/terms/">Terms and Conditions</a></li>
            </ul>
         </div>
      </div>
      <div style="text-align: center; margin-top: 10px;">
         
            <p class="p-name">Copyright &copy; 2025 Firas Esbai.</p>
            
      </div>
   </div>
</footer><!-- Cookie Consent Logic -->	
	<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script>
	<script src="/js/cookie-consent-script.js" type="text/javascript"> </script>

  </body>

</html>